# Output Aggregator Module for Rule-Based Credit Behaviour Insight Engine

## Overview
The Output Aggregator Module collects, organizes, ranks and presents insights generated by the Rule Engine. For the current scope the aggregator prints a formatted report to the console (no file exporters).

## Objectives (current scope)
- Collect insights from the Rule Engine.
- Group insights by label (or other key).
- Sort insights by severity and timestamp.
- Print a clear, human-readable report to the console.
- Keep implementation simple for integration/testing.

## Data Model
Each insight is a dictionary with recommended keys:
- label: str (e.g., "ðŸ”´ High Utilization")
- type: str (e.g., "Revolving Credit Overuse")
- message: str
- recommendation: str (optional)
- severity: str ("high" | "medium" | "low")
- timestamp: ISO string (auto-added by aggregator)

Example:
```python
{
  "label": "ðŸ”´ High Utilization",
  "type": "Revolving Credit Overuse",
  "message": "Credit card utilization at 85%",
  "recommendation": "Pay down balances or request limit increase",
  "severity": "high"
}
```

## Steps for Implementation

### 1. Insight Collection
- **Data Structure**:
  ```python
  {
      'label': 'ðŸ”´ High Utilization',
      'insights': [
          {
              'type': 'Revolving Credit Overuse',
              'message': 'Your credit card has 85% utilization',
              'recommendation': 'Consider paying down balance...',
              'severity': 'high',
              'timestamp': '2023-10-17T10:30:00'
          }
      ]
  }
  ```
- **Implementation**:
  - Create collectors for different insight types
  - Implement sorting and grouping logic
  - Add metadata (timestamp, severity, source)

### 2. Report Generation
- **Format Types**:
  - JSON: Structured data export
  - HTML: Web-friendly formatted report
  - PDF: Printable document format
- **Implementation**:
  - Create template-based report generation
  - Implement formatting for each output type
  - Add styling and branding elements

### 3. Insight Prioritization
- **Ranking Criteria**:
  - Severity levels (High, Medium, Low)
  - Impact scores
  - Time sensitivity
- **Implementation**:
  - Define prioritization algorithms
  - Implement sorting mechanisms
  - Add weight factors for different criteria

### 4. Export Handlers
- **Handler Types**:
  - JSONExporter: Structured data output
  - HTMLExporter: Web-friendly format
  - PDFExporter: Document generation
- **Implementation**:
  - Create base exporter interface
  - Implement specific format handlers
  - Add export configuration options

## Example Interface
```python
class OutputAggregator:
    def __init__(self):
        """Initialize aggregator with configuration"""
        pass

    def add_insight(self, insight: dict):
        """Add a single insight to the collection"""
        pass

    def group_insights(self, grouping_key: str):
        """Group insights by specified key"""
        pass

    def generate_report(self, format: str):
        """Generate report in specified format"""
        pass

    def export(self, filepath: str, format: str):
        """Export aggregated insights to file"""
        pass
```

## Testing
- **Unit Tests**:
  - Test insight collection
  - Test grouping logic
  - Test export formats
  - Test prioritization
- **Integration Tests**:
  - Test with real rule engine output
  - Verify report formatting
  - Validate export functionality

## Error Handling
```python
# Example error scenarios:
errors = {
    "invalid_format": "Unsupported export format",
    "empty_insights": "No insights to aggregate",
    "export_failed": "Failed to write to file"
}
```

## Future Enhancements
- **Advanced Features**:
  - Interactive HTML reports
  - Custom report templates
  - Report scheduling
  - Email distribution
- **Performance Optimization**:
  - Batch processing
  - Async export
  - Report caching

## Usage Example
```python
# Basic usage
aggregator = OutputAggregator()

# Add insights
aggregator.add_insight({
    'label': 'ðŸ”´ High Utilization',
    'type': 'Revolving Credit Overuse',
    'message': 'Credit card utilization at 85%',
    'severity': 'high'
})

# Generate report
report = aggregator.generate_report(format='html')
aggregator.export('credit_report.html', format='html')
```